<apex:page standardStylesheets="false" showHeader="true" sidebar="false" controller="WhiteboardController" id="thePage">
    <apex:stylesheet value="{!URLFOR($Resource.bootstrap, '/bootstrap/css/bootstrap.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.WBStyles, '/css/newStyle.css')}"/>
    <script src="{!URLFOR($Resource.jQueryLibrary)}"/>
    <script src="{!URLFOR($Resource.bootstrap, '/bootstrap/js/bootstrap.js')}"/>
    
    <script type="text/javascript">        
        var itemId;
        var j$ = jQuery.noConflict();
        function setWhiteboardId()
        {
            document.getElementById('thePage:itemFormA:whiteboardId').value = itemId;
        }
    </script>

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span2" style="border:right">
                <p>Sidebar</p>    
            </div>
            <apex:outputPanel id="wholePage">
            <div class="span10" id="mainSection">
                <div class="row">
                    <div class="span10" id="whiteboardButtons">
                        <apex:form >
                            <apex:commandButton styleClass="btn" id="switchToCompany" action="{!getCompanyItems}" value="Company Whiteboard" reRender=""/>
                            <apex:commandButton styleClass="btn" id="switchToPersonal" action="{!getPersonalItems}" value="Personal Whiteboard"/>
                        </apex:form>
                    </div>
                </div>

                <div class="row">
                    <div class="span10">
                        <apex:sectionHeader title="{!currentWhiteboard}" id="title"/>
                        <button href="#myModal" role="button" class="btn btn-primary" data-toggle="modal" data-backdrop="false">New Item</button>
                    </div>
                    <!-- NEW ITEM MODAL -->
                    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <apex:form id="itemFormC">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                                <h3 id="myModalLabel">New Item</h3>
                            </div>
                            <div class="modal-body">
                                <span class="modalLabel">Name</span><apex:inputField label="Name" value="{!Item.Name}" styleClass="modalInput modalActInput"/>
                            </div>
                            <div class="modal-footer">
                                <apex:commandButton styleClass="btn btn-primary" action="{!save}" value="Save"/>
                                <apex:commandButton styleClass="btn" value="Cancel"/>
                            </div>
                        </apex:form>
                    </div>
                    <!-- END MODAL -->
                </div>
                <br/>
                <div class="heading">
                    <p>Current Items</p>
                </div>
                <apex:outputPanel id="pageContent">
                    <div class="row">
                        <div class="span10">
                            <div class="accordion" id="accordion2" style="margin-bottom: 0px;">
                                <apex:repeat value="{!currentItems}" var="item" id="itemList">  <!-- Starts the repetition of the ITEMS -->
                                    <div class="accordion-group itemBar">
                                        <div class="nav pull-right buttonLine">
                                            <apex:form >
                                                <apex:commandButton action="{!deleteItem}" value="✖" id="delete" reRender="wholePage" styleClass="close" onclick="if (!confirm('Are you sure you want to delete this item forever?')) {return;};">
                                                    <apex:param name="ItemId" value="{!item.Id}"/>
                                                </apex:commandButton>
                                                <apex:commandButton action="{!completeItem}" value="✔" id="complete" reRender="wholePage" styleClass="close" >
                                                    <apex:param name="ItemId" value="{!item.Id}"/>
                                                </apex:commandButton>
                                                <button href="#myModalAct" role="button" class="close btn" data-toggle="modal" data-backdrop="false" onclick="itemId='{!item.Id}'">✚</button>
                                                <apex:commandLink styleClass="priority" rendered="{!IF(item.High_Priority__c == true, true, false)}"  action="{!unsetPriority}" rerender="wholePage">
                                                    <apex:image url="{!URLFOR($Resource.bootstrap, '/bootstrap/img/priority.png')}" width="25"/>
                                                    <apex:param name="ItemId" value="{!item.Id}"/>
                                                </apex:commandLink>
                                                <apex:commandLink styleClass="priority" rendered="{!IF(item.High_Priority__c == true, false, true)}" action="{!setPriority}" rerender="wholePage">
                                                    <apex:image url="{!URLFOR($Resource.bootstrap, '/bootstrap/img/nopriority.png')}" width="25"/>
                                                    <apex:param name="ItemId" value="{!item.Id}"/>
                                                </apex:commandLink>
                                            </apex:form>
                                        </div>
                                        <div class="nav pull-left buttonLine">
                                            
                                        </div>
                                        <div class="accordion-heading" ondblclick="window.location='/{!item.Id}'">
                                            <a class="accordion-toggle itemTitle" data-toggle="collapse" data-parent="#accordion2" href="#{!item.Id}">{!item.Name}</a> 
                                        </div>
                                        <div id="{!item.Id}" class="accordion-body collapse">
                                            <apex:repeat value="{!item.Whiteboard_Item_Activities__r}" var="act" id="actList" rendered="{!IF(item.Whiteboard_Item_Activities__r.size == 0, false, true)}">
                                                <div class="accordion-inner activityRow" style="{!IF(act.Completed__c == true, 'text-decoration: line-through; opacity: .6;', '')}">
                                                    <div class="nav pull-right buttonLine">
                                                        <apex:form >
                                                            <apex:commandButton action="{!deleteAct}" value="✖" id="delete" reRender="wholePage" styleClass="{!IF(act.Completed__c == true, 'btn close restoreButton trashButton', 'close')}" onclick="if (!confirm('Are you sure you want to delete this activity forever?')) {return;};">
                                                                <apex:param name="ActId" value="{!act.Id}"/>
                                                            </apex:commandButton>
                                                            <apex:outputPanel rendered="{!IF(act.Completed__c == true, true, false)}">
                                                                <apex:commandButton reRender="wholePage" action="{!uncompleteAct}" value="➦" id="untrash" styleClass="btn close restoreButton trashButton" >
                                                                    <apex:param name="ActId" value="{!act.Id}"/>
                                                                </apex:commandButton>
                                                                <div class="completedby">
                                                                    <apex:outputText value="Completed By: {!act.CompletedBy__r.Name}" />
                                                                </div>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!IF(act.Completed__c == true, false, true)}">
                                                                <apex:commandButton action="{!completeAct}" value="✔" id="complete" reRender="wholePage" styleClass="close" >
                                                                    <apex:param name="ActId" value="{!act.Id}"/>
                                                                </apex:commandButton>
                                                            </apex:outputPanel>
                                                            <apex:commandLink styleClass="priority" rendered="{!IF(act.High_Priority__c == true, true, false)}"  action="{!unsetActPriority}" rerender="wholePage">
                                                                <apex:image url="{!URLFOR($Resource.bootstrap, '/bootstrap/img/priority.png')}" width="25"/>
                                                                <apex:param name="ActId" value="{!act.Id}"/>
                                                            </apex:commandLink>
                                                            <apex:commandLink styleClass="priority" rendered="{!IF(act.High_Priority__c == true, false, true)}" action="{!setActPriority}" rerender="wholePage">
                                                                <apex:image url="{!URLFOR($Resource.bootstrap, '/bootstrap/img/nopriority.png')}" width="25"/>
                                                                <apex:param name="ActId" value="{!act.Id}"/>
                                                            </apex:commandLink>
                                                        </apex:form>
                                                    </div>
                                                    <!-- ITEM INNER ACCORDION -->
                                                    <div class="accordion-heading" ondblclick="window.location='/{!act.Id}'">
                                                        <a class="accordion-toggle activityTitle" data-toggle="collapse" data-parent="#accordion3" href="#{!act.Id}">
                                                            {!act.Name}
                                                        </a>
                                                    </div>
                                                    <apex:outputPanel rendered="{!IF(AND(act.Description__c == '', ISBLANK(act.Due_Date__c)), false, true)}">
                                                    <div id="{!act.Id}" class="accordion-body collapse">
                                                        <div class="accordion-inner">
                                                            <ul class="listWrapper">
                                                                <apex:outputPanel rendered="{!IF(act.Description__c == '', false, true)}">
                                                                    <div class="activityDescription">
                                                                        <li>{!act.Description__c}</li>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!IF(ISBLANK(act.Due_Date__c), false, true)}">
                                                                    <div class="activityDate">
                                                                        <li><apex:outputField value="{!act.Due_Date__c}"/></li>
                                                                    </div>
                                                                </apex:outputPanel>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!IF(AND(act.Description__c == '', ISBLANK(act.Due_Date__c)), true, false)}">
                                                        <div id="{!act.Id}" class="accordion-body collapse">
                                                            <div class="accordion-inner">
                                                                <ul class="listWrapper">
                                                                    <li>No description or due date specified</li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <!-- END ACCORDION -->
                                                </div>
                                            </apex:repeat>
                                            <apex:outputPanel rendered="{!IF(item.Whiteboard_Item_Activities__r.size == 0, true, false)}" >
                                                <div class="accordion-inner activityRow">
                                                    <!-- ITEM INNER ACCORDION -->
                                                    <div class="accordion-heading">
                                                        <a class="accordion-toggle activityTitle" data-toggle="collapse" data-parent="#accordion3">
                                                            No Activities
                                                        </a>
                                                    </div>
                                                    <!-- END ACCORDION -->
                                                </div>
                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                </apex:repeat>
                            </div>
                        </div>
                    </div>
                </apex:outputPanel> <!-- Ends the list of Items -->
    
                <!-- NEW Activity MODAL -->
                <div id="myModalAct" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <apex:form id="itemFormA">
                        <apex:inputHidden id="whiteboardId" value="{!whiteboardId}"/>
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                            <h3 id="myModalLabel">New Activity</h3>
                        </div>
                        <div class="modal-body">
                            <span class="modalLabel">Name</span><apex:inputField label="Name" value="{!activity.Name}" styleClass="modalActInput modalName"/><br/>
                            <span class="modalLabel">Description</span><apex:inputField label="Description" value="{!activity.Description__c}" styleClass="modalActInput modalDescription"/><br/>
                            <span class="modalLabel">Due Date</span><apex:inputField label="Due Date" value="{!activity.Due_Date__c}" styleClass="modalActInput modalDate"/><br/>
                        </div>
                        <div class="modal-footer">
                            <apex:commandButton styleClass="btn btn-primary" action="{!saveAct}" value="Save" onclick="setWhiteboardId();"/>
                            <apex:commandButton styleClass="btn" value="Cancel"/>
                        </div>
                    </apex:form>
                </div>
                <!-- END MODAL -->
                
                <hr/>
                <div class="heading">
                    <p>Completed Items</p>
                </div>
                <apex:outputPanel id="completedContent">
                <div class="row">
                    <div class="span10">
                        <div class="accordion" id="accordion4">
                            <apex:repeat value="{!completedItems}" var="item" id="completedItemList">   <!-- Starts the repetition of the ITEMS -->
                                <div class="accordion-group itemBarTrash">
                                    <div class="nav pull-right buttonLine">
                                        <apex:form >
                                            <apex:commandButton action="{!deleteItem}" value="✖" id="delete" reRender="wholePage" styleClass="btn close trashButton" onclick="if (!confirm('Are you sure you want to delete this item forever?')) {return;};">
                                                <apex:param name="ItemId" value="{!item.Id}"/>
                                            </apex:commandButton>
                                            <apex:commandButton reRender="wholePage" action="{!uncompleteItem}" value="➦" id="untrash" styleClass="btn close restoreButton trashButton" >
                                                <apex:param name="ItemId" value="{!item.Id}"/>
                                            </apex:commandButton>
                                            <div class="completedby">
                                            	<apex:outputText value="Completed By: {!item.CompletedBy__r.Name}" />
                                            </div>
                                        </apex:form>
                                     </div>
                                    <div class="accordion-heading" ondblclick="window.location='/{!item.Id}'">
                                        <a class="accordion-toggle itemTitle" data-toggle="collapse" data-parent="#accordion4" href="#{!item.Id}">
                                            {!item.Name}
                                        </a> 
                                    </div>
                                    <div id="{!item.Id}" class="accordion-body collapse">
                                            <apex:repeat value="{!item.Whiteboard_Item_Activities__r}" var="act" id="actList" rendered="{!IF(item.Whiteboard_Item_Activities__r.size == 0, false, true)}">
                                                <div class="accordion-inner activityRow">
                                                    <div class="nav pull-right buttonLine">
                                                        <apex:form >
                                                            <apex:outputPanel rendered="{!IF(act.Completed__c == true, true, false)}">
                                                                <div class="completedby">
                                                                    <apex:outputText value="Completed By: {!act.CompletedBy__r.Name}" />
                                                                </div>
                                                            </apex:outputPanel>
                                                        </apex:form>
                                                    </div>
                                                    <!-- ITEM INNER ACCORDION -->
                                                    <div class="accordion-heading" ondblclick="window.location='/{!act.Id}'">
                                                        <a class="accordion-toggle activityTitle" data-toggle="collapse" data-parent="#accordion3" href="#{!act.Id}">
                                                            {!act.Name}
                                                        </a>
                                                    </div>
                                                    <apex:outputPanel rendered="{!IF(AND(act.Description__c == '', ISBLANK(act.Due_Date__c)), false, true)}">
                                                    <div id="{!act.Id}" class="accordion-body collapse">
                                                        <div class="accordion-inner">
                                                            <ul class="listWrapper">
                                                                <apex:outputPanel rendered="{!IF(act.Description__c == '', false, true)}">
                                                                    <div class="activityDescription">
                                                                        <li>{!act.Description__c}</li>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!IF(ISBLANK(act.Due_Date__c), false, true)}">
                                                                    <div class="activityDate">
                                                                        <li><apex:outputField value="{!act.Due_Date__c}"/></li>
                                                                    </div>
                                                                </apex:outputPanel>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!IF(AND(act.Description__c == '', ISBLANK(act.Due_Date__c)), true, false)}">
                                                        <div id="{!act.Id}" class="accordion-body collapse">
                                                            <div class="accordion-inner">
                                                                <ul class="listWrapper">
                                                                    <li>No description or due date specified</li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <!-- END ACCORDION -->
                                                </div>
                                            </apex:repeat>
                                            <apex:outputPanel rendered="{!IF(item.Whiteboard_Item_Activities__r.size == 0, true, false)}" >
                                                <div class="accordion-inner activityRow">
                                                    <!-- ITEM INNER ACCORDION -->
                                                    <div class="accordion-heading">
                                                        <a class="accordion-toggle activityTitle" data-toggle="collapse" data-parent="#accordion3">
                                                            No Activities
                                                        </a>
                                                    </div>
                                                    <!-- END ACCORDION -->
                                                </div>
                                            </apex:outputPanel>
                                        </div>
                                </div>
                            </apex:repeat>
                        </div>
                    </div>
                </div> <!-- ENDS trashed secion -->
                </apex:outputPanel>
                
            </div> <!-- ENDS main page section -->
            </apex:outputPanel>
        </div> <!-- ENDS row fluid -->

    </div> <!-- ENDS container-fluid -->
               
</apex:page>